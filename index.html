<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
  <title>ì½©ì¼€ì–´</title>

  <link rel="manifest" href="/manifest.json">
  <meta name="theme-color" content="#ffffff">

  <style>
    :root{
      --bg:#f5f7fb; --card:#ffffff; --text:#0f172a; --muted:#64748b;
      --line:#e2e8f0; --blue:#2563eb; --soft:#eef2ff;
    }
    *{box-sizing:border-box}

    /* âœ… ìŠ¤í¬ë¡¤ ê°•ì œ ì•ˆì • */
    html, body{
      height:auto !important;
      min-height:100% !important;
      overflow-x:hidden !important;
      overflow-y:auto !important;
    }
    body{
      margin:0;
      -webkit-overflow-scrolling: touch;
      touch-action: pan-y;
      font-family:-apple-system,BlinkMacSystemFont,"Apple SD Gothic Neo","Noto Sans KR",sans-serif;
      background:var(--bg); color:var(--text);
    }

    .wrap{max-width:560px;margin:0 auto;padding:18px}
    .top{text-align:center;margin:8px 0 14px}
    .title{font-size:30px;font-weight:900;margin:0}
    .subtitle{margin:8px 0 0;font-size:15px;color:#555;line-height:1.6}
    .meta{margin-top:10px;font-size:12px;color:var(--muted);line-height:1.5}

    .banner{
      display:none;background:var(--soft);border:1px dashed var(--blue);
      border-radius:14px;padding:12px;font-size:13px;line-height:1.55;margin:12px 0 14px;text-align:left
    }
    .banner b{font-weight:900}

    .card{
      background:var(--card);border-radius:18px;padding:16px;margin:14px 0;
      box-shadow:0 6px 16px rgba(0,0,0,.06);border:1px solid #f1f5f9;
    }
    .pillRow{display:flex;justify-content:space-between;gap:10px;align-items:center;margin:0 0 8px}
    .card h2{margin:0;font-size:20px;font-weight:900;letter-spacing:-0.2px}
    .badge{
      display:inline-block;font-size:12px;font-weight:900;background:var(--soft);
      border:1px solid #e0e7ff;color:#3730a3;border-radius:999px;padding:6px 10px;white-space:nowrap;
    }
    .sum{margin:0 0 8px;font-size:15px;font-weight:900;line-height:1.55}
    .where,.money{margin:0 0 8px;font-size:13px;line-height:1.55}
    .where{color:var(--muted)}
    .money b{font-weight:900}

    .linkRow{display:grid;gap:10px;margin-top:10px}
    .linkItem{border:1px solid var(--line);border-radius:14px;background:#fff;overflow:hidden}
    .linkTop{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px}
    .linkA{flex:1;text-decoration:none;color:var(--text);font-weight:900;font-size:15px;line-height:1.35}
    button{touch-action:manipulation}
    .qrBtn{border:1px solid #cbd5e1;background:#f8fafc;border-radius:12px;padding:10px 12px;font-weight:900;cursor:pointer}
    .qrBox{display:none;border-top:1px dashed #cbd5e1;padding:12px;text-align:center;background:#fff}
    .qrBox img{width:160px;height:160px}
    .qrHint{font-size:12px;color:var(--muted);margin-bottom:8px}
    .tiny{font-size:12px;color:var(--muted);line-height:1.5;margin-top:8px}

    /* âœ… í•˜ë‹¨ 3ì¢…ì„¸íŠ¸(ê³ ì • ê¸ˆì§€) */
    .bottomPack{
      background:#fff;border:1px solid var(--line);
      border-radius:18px;padding:14px;box-shadow:0 6px 16px rgba(0,0,0,.06);
      margin-top:18px;
    }
    .bottomTitle{font-weight:900;font-size:15px;margin:0 0 10px 0}
    .bottomRow{display:grid;gap:10px}
    .bottomLink{
      display:block;text-align:center;padding:14px;border-radius:14px;
      border:1px solid var(--line);background:#fff;text-decoration:none;color:var(--text);
      font-weight:900;font-size:16px
    }
    .bottomBtn{
      width:100%;border:0;background:var(--blue);color:#fff;border-radius:14px;
      padding:14px;font-weight:900;font-size:16px;cursor:pointer
    }
    .bottomQR{margin-top:12px;border:1px dashed #cbd5e1;background:#fff;border-radius:14px;padding:12px;text-align:center}
    .bottomQR .t{font-weight:900;font-size:14px;margin:0 0 8px}
    .bottomQR .s{font-size:12px;color:var(--muted);margin:0 0 10px;line-height:1.5}
    .bottomQR img{width:190px;height:190px}
    .foot{font-size:12px;color:var(--muted);text-align:center;line-height:1.5;margin:16px 0 0}
  </style>
</head>

<body>
<div class="wrap">
  <div class="top">
    <div class="title">ì½©ì¼€ì–´</div>
    <div class="subtitle">íˆ¬ì„í™˜ìÂ·ì‹ ì¥ì´ì‹ ëŒ€ê¸°ìë¥¼ ìœ„í•œ<br><b>ì—¬ìˆ˜ì‹œ ìš°ì„ </b> â€œìš”ì•½ + ì–´ë””ë¡œ + Direct ë§í¬â€</div>
    <div class="meta" id="metaLine">
      â€» ìë™ ì—…ë°ì´íŠ¸: 3ì¼ ê°„ê²© / 03:00(KST) Â· ë‚´ìš© ë³€ê²½ ì‹œ ìë™ ë°˜ì˜(ë¦¬ë¡œë“œ ë£¨í”„ ë°©ì§€ ì ìš©)
    </div>
  </div>

  <div id="installBanner" class="banner">
    <b>ğŸ“² í™ˆí™”ë©´ì— ì¶”ê°€í•˜ë©´ ì•±ì²˜ëŸ¼ ì‚¬ìš©ë©ë‹ˆë‹¤</b><br>
    ì•ˆë“œë¡œì´ë“œ: â‹® â†’ í™ˆ í™”ë©´ì— ì¶”ê°€ / ì•„ì´í°: ê³µìœ  â†’ í™ˆ í™”ë©´ì— ì¶”ê°€<br>
    (ë§¨ ì•„ë˜ â€˜í™ˆí™”ë©´ ì„¤ì¹˜/ì¹´í†¡ ê³µìœ â€™ ë²„íŠ¼ë„ ì‚¬ìš© ê°€ëŠ¥)
  </div>

  <div class="card">
    <h2>ì•ˆë‚´</h2>
    <div class="sum">í˜„ì¬ í™”ë©´ì—ì„œ â€œì£¼ì†Œì°½ ë°‘ ì›€ì§ì´ëŠ” ì¤„â€ì´ ë³´ì´ë©´ ìë™ ê°±ì‹ ì´ ë°˜ë³µë˜ëŠ” ìƒíƒœì…ë‹ˆë‹¤.</div>
    <div class="where">ì´ë²ˆ ë²„ì „ì€ ë°˜ë³µ ë¦¬ë¡œë“œê°€ ì ˆëŒ€ ë°œìƒí•˜ì§€ ì•Šë„ë¡ ì°¨ë‹¨í–ˆìŠµë‹ˆë‹¤.</div>
  </div>

  <!-- (ê¸°ì¡´ â‘ ~â‘©/ì•±ë‹¤ìš´/í•˜ë‹¨3ì¢…ì„¸íŠ¸ëŠ” í˜•ì´ ì´ë¯¸ ì“°ëŠ” ì½”ë“œ ìœ ì§€ ê°€ëŠ¥)
       ì—¬ê¸°ì„œëŠ” â€œë¦¬ë¡œë“œ ë£¨í”„ ì°¨ë‹¨â€ í•µì‹¬ë§Œ í™•ì • ì œê³µ.
       í˜•ì´ ì›í•˜ë©´ ë‹¤ìŒ ë©”ì‹œì§€ì— â‘ ~â‘© ì „ì²´ í¬í•¨ ì™„ì „ë³¸ìœ¼ë¡œ ë‹¤ì‹œ í•©ì³ì„œ ë“œë¦´ê²Œìš”. -->

  <!-- âœ… ë§¨ ì•„ë˜ ë¬´ì¡°ê±´ 3ì¢…ì„¸íŠ¸(ê³ ì • ê¸ˆì§€) -->
  <div class="bottomPack">
    <div class="bottomTitle">ğŸ“² ì½©ì¼€ì–´ ì•± ì„¤ì¹˜/ê³µìœ (ë°”íƒ•í™”ë©´ ë°”ë¡œê°€ê¸°)</div>
    <div class="bottomRow">
      <a class="bottomLink" href="https://kongcare.vercel.app/?install=1" target="_blank" rel="noopener">
        ì½©ì¼€ì–´ ì–´í”Œ ë§í¬ ì—´ê¸° (install=1)
      </a>
      <button class="bottomBtn" onclick="openInstallShare()">
        í™ˆí™”ë©´ ë°”ë¡œê°€ê¸° ì„¤ì¹˜ / ì¹´í†¡ ê³µìœ 
      </button>
    </div>
    <div class="bottomQR">
      <p class="t">QR ì°ê³  â†’ í™ˆ í™”ë©´ì— ì¶”ê°€</p>
      <p class="s">ì•„ë˜ QRì€ <b>install=1</b> ë§í¬ì…ë‹ˆë‹¤. (ì„¤ì¹˜ ì•ˆë‚´ ìë™ í‘œì‹œ)</p>
      <img alt="ì½©ì¼€ì–´ ì„¤ì¹˜ QR"
           src="https://api.qrserver.com/v1/create-qr-code/?size=190x190&data=https%3A%2F%2Fkongcare.vercel.app%2F%3Finstall%3D1">
      <p class="s" style="margin-top:10px">QR ì´ë¯¸ì§€ëŠ” ì¹´í†¡ìœ¼ë¡œ ì €ì¥/ê³µìœ í•´ë„ ë©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <div class="foot" id="updateStatus"></div>
</div>

<script>
/* âœ… QR í† ê¸€ ê³µìš© */
function toggleQR(btn, url){
  const card = btn.closest('.linkItem') || btn.closest('.newsCard');
  const box = card.querySelector('.qrBox');
  const open = box.style.display === 'block';
  if(open){ box.style.display='none'; box.innerHTML=''; return; }
  const imgUrl = 'https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=' + encodeURIComponent(url);
  box.innerHTML = '<div class="qrHint">QRì„ ì°ìœ¼ë©´ ì´ ë§í¬ë¡œ ë°”ë¡œ ì´ë™í•©ë‹ˆë‹¤</div><img alt="QR" src="'+imgUrl+'">';
  box.style.display='block';
}

/* install=1 ë°°ë„ˆ */
(function(){
  const p = new URLSearchParams(location.search);
  if(p.has("install")){
    const b = document.getElementById("installBanner");
    if(b) b.style.display = "block";
  }
})();

/* ì„¤ì¹˜/ê³µìœ  */
let deferredPrompt = null;
window.addEventListener('beforeinstallprompt', (e) => { e.preventDefault(); deferredPrompt = e; });

async function openInstallShare(){
  const url = "https://kongcare.vercel.app/?install=1";
  const msg = "ì½©ì¼€ì–´ ë§í¬ì…ë‹ˆë‹¤: " + url;

  if(deferredPrompt){
    deferredPrompt.prompt();
    try{ await deferredPrompt.userChoice; }catch(e){}
    deferredPrompt = null;
    alert("ì„¤ì¹˜ê°€ ì™„ë£Œë˜ë©´ ì¹´í†¡ìœ¼ë¡œ ë§í¬ë¥¼ ê³µìœ í•´ ì£¼ì„¸ìš”.");
    return;
  }
  if(navigator.share){
    try{ await navigator.share({title:"ì½©ì¼€ì–´", text:msg, url}); return; }catch(e){}
  }
  try{
    await navigator.clipboard.writeText(msg);
    alert("ë§í¬ë¥¼ ë³µì‚¬í–ˆìŠµë‹ˆë‹¤. ì¹´í†¡ì— ë¶™ì—¬ë„£ê¸° í•˜ì„¸ìš”.");
  }catch(e){
    prompt("ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•´ ì¹´í†¡ì— ë³´ë‚´ì„¸ìš”:", msg);
  }
}

/* âœ… ìë™ ì—…ë°ì´íŠ¸(ë£¨í”„ ë°©ì§€ ë²„ì „)
   - ë³€ê²½ ê°ì§€ëŠ” â€œì„¸ì…˜ë‹¹ 1íšŒë§Œâ€ ìˆ˜í–‰
   - 3ì¼/03ì‹œ ë¦¬ë¡œë“œëŠ” â€œë‹¤ìŒ ì‹œê°„ì´ ì¶©ë¶„íˆ ë©€ ë•Œë§Œâ€ ì˜ˆì•½
*/
function djb2(str){
  let h = 5381;
  for(let i=0;i<str.length;i++) h = ((h<<5)+h) + str.charCodeAt(i);
  return (h >>> 0).toString(16);
}

async function autoRefreshIfChangedOnce(){
  const doneKey = "kongcare_checked_once";
  if(sessionStorage.getItem(doneKey)) return;
  sessionStorage.setItem(doneKey, "1");

  try{
    const res = await fetch(location.pathname + "?v=" + Date.now(), {cache:'no-store'});
    const txt = await res.text();
    const hash = djb2(txt);
    const key = "kongcare_last_hash";
    const prev = localStorage.getItem(key);
    localStorage.setItem(key, hash);

    // ì´ì „ í•´ì‹œê°€ ìˆê³  ë‹¤ë¥´ë©´ 1íšŒë§Œ ê°±ì‹ 
    if(prev && prev !== hash){
      location.href = "/?v=" + Date.now();
    }
  }catch(e){}
}
autoRefreshIfChangedOnce();

// ë‹¤ìŒ 3ì¼/03ì‹œ(KST) ê³„ì‚°(ë£¨í”„ ë°©ì§€: ìµœì†Œ 6ì‹œê°„ ì´ìƒì¼ ë•Œë§Œ setTimeout)
function nextRunKST(){
  const now = new Date();
  const kst = new Date(now.getTime() + (9*60 + now.getTimezoneOffset())*60*1000);
  const base = new Date(kst); base.setHours(3,0,0,0);

  let next = base;
  if(kst >= base) next = new Date(base.getTime() + 3*24*60*60*1000);

  const nextLocal = new Date(next.getTime() - (9*60 + now.getTimezoneOffset())*60*1000);
  return {kstNext:next, localNext:nextLocal};
}

(function scheduleAutoUpdateSafe(){
  const {kstNext, localNext} = nextRunKST();
  const ms = localNext.getTime() - Date.now();

  // ë£¨í”„ ë°©ì§€: 6ì‹œê°„(21600000ms) ì´ìƒì¼ ë•Œë§Œ ì˜ˆì•½
  const MIN_MS = 6 * 60 * 60 * 1000;

  const st = document.getElementById("updateStatus");
  if(st){
    st.textContent = `ë‹¤ìŒ ìë™ ì—…ë°ì´íŠ¸: ${kstNext.toISOString().replace('T',' ').slice(0,16)} (KST)`;
  }

  if(ms > MIN_MS){
    setTimeout(()=>{ location.href = "/?v=" + Date.now(); }, ms);
  }
})();
</script>
</body>
</html>
